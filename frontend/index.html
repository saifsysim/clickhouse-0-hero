<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ClickHouse Explorer ‚Äì Interactive Demo</title>
  <meta name="description"
    content="Interactive ClickHouse demo showcasing MergeTree engines, telemetry dashboards, structured logging, and cost/usage analytics." />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap"
    rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <!-- ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-logo">
      <div class="logo-icon">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round" />
        </svg>
      </div>
      <div>
        <div class="logo-title">ClickHouse</div>
        <div class="logo-sub">Explorer</div>
      </div>
    </div>

    <nav class="sidebar-nav">
      <div class="nav-section-label">Overview</div>
      <button class="nav-item active" data-tab="home" onclick="switchTab('home',this)">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" stroke="currentColor" stroke-width="2" />
          <polyline points="9 22 9 12 15 12 15 22" stroke="currentColor" stroke-width="2" />
        </svg>
        Introduction
      </button>
      <button class="nav-item" data-tab="engines" onclick="switchTab('engines',this)">
        <svg viewBox="0 0 24 24" fill="none">
          <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" />
          <path
            d="M19.07 4.93l-1.41 1.41M4.93 4.93l1.41 1.41M4.93 19.07l1.41-1.41M19.07 19.07l-1.41-1.41M12 2v2m0 18v-2m10-8h-2M4 12H2"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" />
        </svg>
        DB Engines
      </button>

      <div class="nav-section-label">Use Cases</div>
      <button class="nav-item" data-tab="telemetry" onclick="switchTab('telemetry',this)">
        <svg viewBox="0 0 24 24" fill="none">
          <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round" />
        </svg>
        Telemetry
      </button>
      <button class="nav-item" data-tab="logging" onclick="switchTab('logging',this)">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2" />
          <polyline points="14 2 14 8 20 8" stroke="currentColor" stroke-width="2" />
          <line x1="16" y1="13" x2="8" y2="13" stroke="currentColor" stroke-width="2" />
          <line x1="16" y1="17" x2="8" y2="17" stroke="currentColor" stroke-width="2" />
          <polyline points="10 9 9 9 8 9" stroke="currentColor" stroke-width="2" />
        </svg>
        Structured Logging
      </button>
      <button class="nav-item" data-tab="costs" onclick="switchTab('costs',this)">
        <svg viewBox="0 0 24 24" fill="none">
          <line x1="12" y1="1" x2="12" y2="23" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
          <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round" />
        </svg>
        Cost & Usage
      </button>

      <div class="nav-section-label">Playground</div>
      <button class="nav-item" data-tab="cluster" onclick="switchTab('cluster',this)">
        <svg viewBox="0 0 24 24" fill="none">
          <circle cx="12" cy="5" r="3" stroke="currentColor" stroke-width="2" />
          <circle cx="5" cy="19" r="3" stroke="currentColor" stroke-width="2" />
          <circle cx="19" cy="19" r="3" stroke="currentColor" stroke-width="2" />
          <path d="M12 8v3m0 0-5 5m5-5 5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
        </svg>
        Cluster & Replication
      </button>
      <button class="nav-item" data-tab="query" onclick="switchTab('query',this)">
        <svg viewBox="0 0 24 24" fill="none">
          <polyline points="4 17 10 11 4 5" stroke="currentColor" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round" />
          <line x1="12" y1="19" x2="20" y2="19" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
        </svg>
        SQL Playground
      </button>

      <div class="nav-section-label">Learn</div>
      <button class="nav-item" data-tab="guide" onclick="switchTab('guide',this)" id="guide-nav-btn">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" stroke="currentColor" stroke-width="2"
            stroke-linejoin="round" />
          <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" stroke="currentColor" stroke-width="2"
            stroke-linejoin="round" />
        </svg>
        Learning Guide
      </button>

      <div class="nav-section-label">AI Layer</div>
      <button class="nav-item ai-nav-item" data-tab="ai" onclick="switchTab('ai',this)" id="ai-nav-btn">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M12 2a7 7 0 0 1 7 7c0 3.5-2 6-5 7v1a1 1 0 0 1-2 0v-1c-3-1-5-3.5-5-7a7 7 0 0 1 7-7z"
            stroke="currentColor" stroke-width="2" />
          <path d="M9 21h6" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
        </svg>
        AI Assistant
        <span class="ai-badge" id="ai-status-dot">‚óè</span>
      </button>
    </nav>

    <div class="sidebar-footer">
      <div class="connection-badge" id="connectionBadge">
        <span class="badge-dot"></span>
        <span id="connectionText">Connecting‚Ä¶</span>
      </div>
    </div>
  </aside>

  <!-- ‚îÄ‚îÄ Main ‚îÄ‚îÄ -->
  <main class="main-content">
    <!-- ‚îÄ‚îÄ‚îÄ HOME ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <section class="tab-panel active" id="tab-home">
      <div class="page-header">
        <h1>Welcome to ClickHouse Explorer</h1>
        <p class="page-subtitle">An interactive, hands-on introduction to ClickHouse ‚Äî the blazing-fast columnar OLAP
          database. Explore real data across three production use cases.</p>
      </div>

      <div class="intro-grid">
        <div class="intro-card glass">
          <div class="intro-icon" style="background:linear-gradient(135deg,#f59e0b,#d97706)">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" />
            </svg>
          </div>
          <h3>Blazing Fast</h3>
          <p>ClickHouse processes billions of rows per second using vectorized query execution and columnar storage.</p>
        </div>
        <div class="intro-card glass">
          <div class="intro-icon" style="background:linear-gradient(135deg,#6366f1,#4f46e5)">
            <svg viewBox="0 0 24 24" fill="none">
              <path
                d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"
                stroke="currentColor" stroke-width="2" />
            </svg>
          </div>
          <h3>Rich Engine Family</h3>
          <p>Six specialized table engines ‚Äî each optimised for different workloads: time-series, aggregation,
            deduplication, and more.</p>
        </div>
        <div class="intro-card glass">
          <div class="intro-icon" style="background:linear-gradient(135deg,#10b981,#059669)">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" />
              <polyline points="22 4 12 14.01 9 11.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" />
            </svg>
          </div>
          <h3>Production Ready</h3>
          <p>Battle-tested by Cloudflare, Uber, and hundreds of enterprises processing petabytes of data.</p>
        </div>
      </div>

      <div class="section-title">What You'll Learn</div>
      <div class="learn-grid">
        <div class="learn-item" onclick="switchTab('engines', document.querySelector('[data-tab=engines]'))">
          <div class="learn-num">01</div>
          <div>
            <strong>Database Engines</strong>
            <p>MergeTree, SummingMergeTree, AggregatingMergeTree, ReplacingMergeTree, CollapsingMergeTree</p>
          </div>
        </div>
        <div class="learn-item" onclick="switchTab('telemetry', document.querySelector('[data-tab=telemetry]'))">
          <div class="learn-num">02</div>
          <div>
            <strong>Telemetry Pipeline</strong>
            <p>High-throughput event ingestion, real-time dashboards, funnels, and user analytics</p>
          </div>
        </div>
        <div class="learn-item" onclick="switchTab('logging', document.querySelector('[data-tab=logging]'))">
          <div class="learn-num">03</div>
          <div>
            <strong>Structured Logging</strong>
            <p>Indexed log storage with TTL, full-text search, error rate tracking, and trace correlation</p>
          </div>
        </div>
        <div class="learn-item" onclick="switchTab('costs', document.querySelector('[data-tab=costs]'))">
          <div class="learn-num">04</div>
          <div>
            <strong>Cost & Usage Analytics</strong>
            <p>API spend tracking, per-team budgets, anomaly alerts, and cost-per-call analysis</p>
          </div>
        </div>
      </div>

      <div class="section-title">ClickHouse Architecture at a Glance</div>
      <div class="arch-diagram glass">
        <div class="arch-column">
          <div class="arch-label">Ingestion</div>
          <div class="arch-item">HTTP / TCP Client</div>
          <div class="arch-item">Kafka / S3</div>
          <div class="arch-item">Bulk INSERT</div>
        </div>
        <div class="arch-arrow">‚Üí</div>
        <div class="arch-column">
          <div class="arch-label">Storage</div>
          <div class="arch-item">Columnar Parquet</div>
          <div class="arch-item">Parts & Merges</div>
          <div class="arch-item">Sparse Indexes</div>
        </div>
        <div class="arch-arrow">‚Üí</div>
        <div class="arch-column">
          <div class="arch-label">Engines</div>
          <div class="arch-item arch-highlight">MergeTree</div>
          <div class="arch-item arch-highlight">Aggregating</div>
          <div class="arch-item arch-highlight">Replacing</div>
        </div>
        <div class="arch-arrow">‚Üí</div>
        <div class="arch-column">
          <div class="arch-label">Query</div>
          <div class="arch-item">Vectorized Exec</div>
          <div class="arch-item">Parallel Scans</div>
          <div class="arch-item">Materialized Views</div>
        </div>
      </div>
    </section>

    <!-- ‚îÄ‚îÄ‚îÄ ENGINES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <section class="tab-panel" id="tab-engines">
      <div class="page-header">
        <h1>ClickHouse Table Engines</h1>
        <p class="page-subtitle">Every table in ClickHouse uses an <em>engine</em> that defines how data is stored,
          merged, and queried. Choose the right engine for your workload.</p>
      </div>

      <div class="engines-grid">

        <div class="engine-card glass">
          <div class="engine-badge" style="background:linear-gradient(135deg,#f59e0b,#d97706)">MergeTree</div>
          <h3>MergeTree</h3>
          <p class="engine-desc">The <strong>foundation</strong> of all ClickHouse engines. Data is written in parts,
            then merged in the background. Supports <code>ORDER BY</code>, <code>PARTITION BY</code>, sparse primary
            indexes, and <code>TTL</code>.</p>
          <div class="code-block">
            -- Used for: telemetry_events, app_logs
            CREATE TABLE events (
            timestamp DateTime,
            service LowCardinality(String),
            user_id String
            )
            ENGINE = MergeTree()
            PARTITION BY toYYYYMM(timestamp)
            ORDER BY (service, timestamp)
            TTL timestamp + INTERVAL 90 DAY;</div>
          <div class="use-cases">
            <span class="tag">üì° Telemetry</span>
            <span class="tag">üìã Logs</span>
            <span class="tag">üìà Time-series</span>
          </div>
          <button class="btn btn-sm" onclick="runEngineDemo('mergetree-demo')">‚ñ∂ Run Live Demo</button>
          <div class="engine-result" id="result-mergetree-demo"></div>
        </div>

        <div class="engine-card glass">
          <div class="engine-badge" style="background:linear-gradient(135deg,#10b981,#059669)">SummingMergeTree</div>
          <h3>SummingMergeTree</h3>
          <p class="engine-desc">Automatically <strong>sums numeric columns</strong> during merges. Perfect for counters
            and accumulators ‚Äî no aggregation needed at query time.</p>
          <div class="code-block">
            -- Used for: cost_usage
            CREATE TABLE cost_usage (
            timestamp DateTime,
            service LowCardinality(String),
            team LowCardinality(String),
            cost_usd Float64,
            api_calls UInt32
            )
            ENGINE = SummingMergeTree(
            (cost_usd, api_calls) -- columns to sum
            )
            ORDER BY (team, service, timestamp);</div>
          <div class="use-cases">
            <span class="tag">üí∞ Cost Tracking</span>
            <span class="tag">üìä Budget Rollup</span>
          </div>
          <button class="btn btn-sm" onclick="runEngineDemo('summing-demo')">‚ñ∂ Run Live Demo</button>
          <div class="engine-result" id="result-summing-demo"></div>
        </div>

        <div class="engine-card glass">
          <div class="engine-badge" style="background:linear-gradient(135deg,#6366f1,#4f46e5)">AggregatingMergeTree
          </div>
          <h3>AggregatingMergeTree</h3>
          <p class="engine-desc">Stores <strong>partial aggregate states</strong> (e.g. HyperLogLog for
            <code>uniq</code>). Used with <em>Materialized Views</em> for blazing-fast pre-computed rollups.
          </p>
          <div class="code-block">
            -- Backing table for the hourly rollup MV
            CREATE TABLE telemetry_hourly_agg (
            hour DateTime,
            service LowCardinality(String),
            event_count AggregateFunction(count),
            unique_users AggregateFunction(uniq, String)
            )
            ENGINE = AggregatingMergeTree()
            ORDER BY (service, hour);

            -- Materialized View feeds it automatically
            CREATE MATERIALIZED VIEW mv_hourly
            TO telemetry_hourly_agg AS
            SELECT toStartOfHour(ts) AS hour, service,
            countState() AS event_count,
            uniqState(user_id) AS unique_users
            FROM events GROUP BY hour, service;</div>
          <div class="use-cases">
            <span class="tag">üìâ Rollups</span>
            <span class="tag">üî≠ Pre-aggregation</span>
          </div>
          <button class="btn btn-sm" onclick="runEngineDemo('aggregating-demo')">‚ñ∂ Run Live Demo</button>
          <div class="engine-result" id="result-aggregating-demo"></div>
        </div>

        <div class="engine-card glass">
          <div class="engine-badge" style="background:linear-gradient(135deg,#ec4899,#db2777)">ReplacingMergeTree</div>
          <h3>ReplacingMergeTree</h3>
          <p class="engine-desc">Keeps only the <strong>latest version</strong> of each row with the same
            <code>ORDER BY</code> key. Great for upsert-style workloads. Deduplication happens asynchronously on merge.
          </p>
          <div class="code-block">
            -- Used for: error_summary
            CREATE TABLE error_summary (
            date Date,
            service LowCardinality(String),
            error_msg String,
            count UInt32,
            version UInt64 -- higher wins
            )
            ENGINE = ReplacingMergeTree(version)
            ORDER BY (date, service, error_msg);

            -- "Upsert" by re-inserting with new version:
            INSERT INTO error_summary VALUES
            (today(), 'api', 'timeout', 42, now64());</div>
          <div class="use-cases">
            <span class="tag">‚ö†Ô∏è Deduplication</span>
            <span class="tag">üîÑ Upserts</span>
          </div>
          <button class="btn btn-sm" onclick="runEngineDemo('replicated-demo')">‚ñ∂ Run Live Demo</button>
          <div class="engine-result" id="result-replicated-demo"></div>
        </div>

        <div class="engine-card glass">
          <div class="engine-badge" style="background:linear-gradient(135deg,#f97316,#ea580c)">CollapsingMergeTree</div>
          <h3>CollapsingMergeTree</h3>
          <p class="engine-desc">Uses a <strong>sign column</strong> (+1/-1) to cancel previous rows. Allows efficient
            in-place corrections without mutations ‚Äî perfect for billing adjustments.</p>
          <div class="code-block">
            -- Used for: budget_limits
            CREATE TABLE budget_limits (
            date Date,
            team LowCardinality(String),
            budget_usd Float64,
            sign Int8 -- +1 insert, -1 cancel
            )
            ENGINE = CollapsingMergeTree(sign)
            ORDER BY (date, team);

            -- Correct a budget: cancel then re-insert
            INSERT INTO budget_limits VALUES
            ('2024-01-01', 'core-platform', 5000, -1),
            ('2024-01-01', 'core-platform', 7500, +1);</div>
          <div class="use-cases">
            <span class="tag">üîÅ Corrections</span>
            <span class="tag">üí≥ Billing</span>
          </div>
          <button class="btn btn-sm" onclick="runEngineDemo('aggregating-demo')">‚ñ∂ View Budget Data</button>
          <div class="engine-result" id="result-collapsing-demo"></div>
        </div>

        <div class="engine-card glass">
          <div class="engine-badge" style="background:linear-gradient(135deg,#14b8a6,#0d9488)">ReplicatedMergeTree</div>
          <h3>ReplicatedMergeTree</h3>
          <p class="engine-desc">All MergeTree variants have a <strong>Replicated</strong> counterpart. Data is
            synchronised across shards via <em>ZooKeeper / ClickHouse Keeper</em> for high availability.</p>
          <div class="code-block">
            -- Production HA setup on 2+ nodes:
            CREATE TABLE events ON CLUSTER my_cluster (
            timestamp DateTime,
            service String
            )
            ENGINE = ReplicatedMergeTree(
            '/clickhouse/tables/{shard}/events',
            '{replica}' -- auto-substituted
            )
            ORDER BY (service, timestamp);
            -- Reads+writes auto-fan-out to all replicas</div>
          <div class="use-cases">
            <span class="tag">üîí High Availability</span>
            <span class="tag">üåç Sharding</span>
          </div>
          <button class="btn btn-sm" onclick="runEngineDemo('replicated-demo')">‚ñ∂ View Log Stats</button>
          <div class="engine-result" id="result-replicated2-demo"></div>
        </div>

      </div>
    </section>

    <!-- ‚îÄ‚îÄ‚îÄ TELEMETRY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <section class="tab-panel" id="tab-telemetry">
      <div class="page-header">
        <h1>Telemetry Dashboard</h1>
        <p class="page-subtitle">Real-time event analytics powered by ClickHouse's <strong>MergeTree</strong> engine and
          <strong>Materialized Views</strong>. Simulating 30k+ events from 7 microservices.
        </p>
      </div>

      <div class="kpi-row" id="telemetryKpis">
        <div class="kpi-card glass">
          <div class="kpi-value" id="kpi-total-events">‚Äî</div>
          <div class="kpi-label">Total Events</div>
        </div>
        <div class="kpi-card glass">
          <div class="kpi-value" id="kpi-unique-users">‚Äî</div>
          <div class="kpi-label">Unique Users</div>
        </div>
        <div class="kpi-card glass">
          <div class="kpi-value" id="kpi-services">‚Äî</div>
          <div class="kpi-label">Active Services</div>
        </div>
        <div class="kpi-card glass">
          <div class="kpi-value" id="kpi-p95">‚Äî</div>
          <div class="kpi-label">P95 Duration (ms)</div>
        </div>
      </div>

      <div class="charts-row">
        <div class="chart-card glass">
          <div class="chart-header">
            <h3>Events Over Time (24h)</h3>
            <div class="chart-note">MergeTree ORDER BY (service, timestamp)</div>
          </div>
          <canvas id="telemetryTimelineChart" height="240"></canvas>
        </div>
        <div class="chart-card glass" style="flex:0 0 340px">
          <div class="chart-header">
            <h3>Event Type Breakdown</h3>
            <div class="chart-note">Queried in &lt; 50ms on 30k rows</div>
          </div>
          <canvas id="telemetryFunnelChart" height="240"></canvas>
        </div>
      </div>

      <div class="chart-card glass">
        <div class="chart-header">
          <h3>Top Services by Event Volume</h3>
          <div class="chart-note">uniq(user_id) uses HyperLogLog for O(1) cardinality</div>
        </div>
        <canvas id="servicesChart" height="160"></canvas>
      </div>

      <div class="section-title" style="margin-top:2rem">Inject a Live Event</div>
      <div class="inject-panel glass">
        <div class="form-row">
          <div class="form-group">
            <label>Service</label>
            <select id="inject-service">
              <option>frontend</option>
              <option>api-gateway</option>
              <option>auth-service</option>
              <option>payment-service</option>
              <option>recommendation-engine</option>
              <option>data-pipeline</option>
            </select>
          </div>
          <div class="form-group">
            <label>Event Type</label>
            <select id="inject-event">
              <option>page_view</option>
              <option>click</option>
              <option>search</option>
              <option>purchase</option>
              <option>signup</option>
              <option>api_call</option>
            </select>
          </div>
          <div class="form-group">
            <label>User ID</label>
            <input id="inject-user" type="text" value="user-1234" />
          </div>
          <button class="btn btn-primary" onclick="injectEvent()">‚ö° INSERT INTO ClickHouse</button>
        </div>
        <div id="inject-result" class="inject-result"></div>
      </div>
    </section>

    <!-- ‚îÄ‚îÄ‚îÄ LOGGING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <section class="tab-panel" id="tab-logging">
      <div class="page-header">
        <h1>Structured Logging</h1>
        <p class="page-subtitle">ClickHouse as your log store ‚Äî with <strong>TTL auto-expiry</strong>, full-text search,
          and sub-second queries across millions of log lines.</p>
      </div>

      <div class="kpi-row">
        <div class="kpi-card glass kpi-debug">
          <div class="kpi-value" id="log-debug">‚Äî</div>
          <div class="kpi-label">DEBUG</div>
        </div>
        <div class="kpi-card glass kpi-info">
          <div class="kpi-value" id="log-info">‚Äî</div>
          <div class="kpi-label">INFO</div>
        </div>
        <div class="kpi-card glass kpi-warn">
          <div class="kpi-value" id="log-warn">‚Äî</div>
          <div class="kpi-label">WARN</div>
        </div>
        <div class="kpi-card glass kpi-error">
          <div class="kpi-value" id="log-error">‚Äî</div>
          <div class="kpi-label">ERROR</div>
        </div>
      </div>

      <div class="charts-row">
        <div class="chart-card glass">
          <div class="chart-header">
            <h3>Error & Warning Rate (24h)</h3>
            <div class="chart-note">toStartOfHour() partitioning enables fast range scans</div>
          </div>
          <canvas id="logErrorRateChart" height="200"></canvas>
        </div>
        <div class="chart-card glass" style="flex: 0 0 360px">
          <div class="chart-header">
            <h3>Top Errors (24h)</h3>
          </div>
          <div id="topErrorsList" class="top-errors-list"></div>
        </div>
      </div>

      <div class="logs-toolbar glass">
        <div class="form-group">
          <label>Level</label>
          <select id="log-level-filter" onchange="loadLogs()">
            <option value="all">All Levels</option>
            <option value="DEBUG">DEBUG</option>
            <option value="INFO">INFO</option>
            <option value="WARN">WARN</option>
            <option value="ERROR">ERROR</option>
          </select>
        </div>
        <div class="form-group">
          <label>Service</label>
          <select id="log-service-filter" onchange="loadLogs()">
            <option value="all">All Services</option>
            <option>frontend</option>
            <option>api-gateway</option>
            <option>auth-service</option>
            <option>payment-service</option>
            <option>recommendation-engine</option>
            <option>data-pipeline</option>
            <option>ml-inference</option>
          </select>
        </div>
        <div class="form-group" style="flex:1">
          <label>Search</label>
          <input id="log-search" type="text" placeholder="Search messages‚Ä¶" oninput="debounceLoadLogs()" />
        </div>
        <button class="btn btn-primary" onclick="loadLogs()">üîç Query</button>
      </div>

      <div class="log-table-wrap glass">
        <table class="log-table">
          <thead>
            <tr>
              <th>Time</th>
              <th>Level</th>
              <th>Service</th>
              <th>Host</th>
              <th>Duration</th>
              <th>Message</th>
            </tr>
          </thead>
          <tbody id="logTableBody">
            <tr>
              <td colspan="6" class="loading-row">Loading‚Ä¶</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- ‚îÄ‚îÄ‚îÄ COSTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <section class="tab-panel" id="tab-costs">
      <div class="page-header">
        <h1>Cost & Usage Analytics</h1>
        <p class="page-subtitle">Track API spend, token consumption, and per-team budgets. Powered by
          <strong>SummingMergeTree</strong> ‚Äî totals are maintained automatically during merges.
        </p>
      </div>

      <div class="kpi-row" id="costKpis">
        <div class="kpi-card glass">
          <div class="kpi-value" id="cost-total">‚Äî</div>
          <div class="kpi-label">Total Spend (30d)</div>
        </div>
        <div class="kpi-card glass">
          <div class="kpi-value" id="cost-tokens">‚Äî</div>
          <div class="kpi-label">Total Tokens</div>
        </div>
        <div class="kpi-card glass">
          <div class="kpi-value" id="cost-calls">‚Äî</div>
          <div class="kpi-label">API Calls</div>
        </div>
        <div class="kpi-card glass">
          <div class="kpi-value" id="cost-avg">‚Äî</div>
          <div class="kpi-label">Avg Cost / 1k calls</div>
        </div>
      </div>

      <div id="cost-alerts" class="alerts-row"></div>

      <div class="charts-row">
        <div class="chart-card glass">
          <div class="chart-header">
            <h3>Daily Spend (30 days)</h3>
            <div class="chart-note">SummingMergeTree auto-sums cost_usd during background merges</div>
          </div>
          <canvas id="dailyCostChart" height="220"></canvas>
        </div>
        <div class="chart-card glass" style="flex: 0 0 340px">
          <div class="chart-header">
            <h3>Spend by Team</h3>
          </div>
          <canvas id="teamCostChart" height="220"></canvas>
        </div>
      </div>

      <div class="chart-card glass">
        <div class="chart-header">
          <h3>Cost per Service (30d)</h3>
          <div class="chart-note">GROUP BY service with avg(cost_usd / api_calls)</div>
        </div>
        <div id="servicesCostTable" class="services-cost-table"></div>
      </div>
    </section>

    <!-- ‚îÄ‚îÄ‚îÄ CLUSTER & REPLICATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <section class="tab-panel" id="tab-cluster">
      <div class="page-header">
        <h1>Sharding &amp; Replication</h1>
        <p class="page-subtitle">Two fundamental ClickHouse cluster concepts ‚Äî <strong>Sharding</strong> splits data
          horizontally across nodes for scale, while <strong>Replication</strong> duplicates data across nodes for high
          availability. This live demo runs a real 2-node cluster.</p>
      </div>

      <!-- Concept Cards -->
      <div class="intro-grid" style="grid-template-columns:repeat(2,1fr);margin-bottom:20px">
        <div class="intro-card glass">
          <div class="intro-icon" style="background:linear-gradient(135deg,#f59e0b,#d97706)">
            <svg viewBox="0 0 24 24" fill="none">
              <rect x="2" y="3" width="9" height="18" rx="2" stroke="currentColor" stroke-width="2" />
              <rect x="13" y="3" width="9" height="18" rx="2" stroke="currentColor" stroke-width="2" />
            </svg>
          </div>
          <h3>Sharding ‚Äî Scale Out</h3>
          <p style="color:var(--text2);font-size:13px;margin-bottom:10px">Each <strong>shard</strong> owns a distinct
            subset of the data. A <code>Distributed</code> table fans writes out (using a sharding key hash) and merges
            reads from all shards transparently.</p>
          <div class="code-block" style="font-size:11px">-- Sharding key assigns each row to a shard
            ENGINE = Distributed(
            demo_cluster, -- cluster name
            cluster_demo, -- database
            events_local, -- local table on each shard
            murmurHash3_32(user_id)-- sharding key
            );
            -- user-42 always goes to shard 1
            -- user-99 always goes to shard 2</div>
          <div class="use-cases">
            <span class="tag">üìà Horizontal Scale</span>
            <span class="tag">‚ö° Parallel Reads</span>
            <span class="tag">üîÄ Hash Routing</span>
          </div>
        </div>

        <div class="intro-card glass">
          <div class="intro-icon" style="background:linear-gradient(135deg,#6366f1,#4f46e5)">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke="currentColor"
                stroke-width="2" />
            </svg>
          </div>
          <h3>Replication ‚Äî High Availability</h3>
          <p style="color:var(--text2);font-size:13px;margin-bottom:10px">Each <strong>replica</strong> holds the same
            data. <strong>ClickHouse Keeper</strong> (ZooKeeper-compatible) coordinates which replica is primary and
            syncs inserts automatically.</p>
          <div class="code-block" style="font-size:11px">-- SAME ZK path on both replicas
            -- different {replica} macro per node
            ENGINE = ReplicatedMergeTree(
            '/clickhouse/tables/ha/events', -- shared ZK path
            '{replica}' -- replica-1 on node1
            -- replica-2 on node2
            );
            -- Write to node1 ‚Üí auto-synced to node2!</div>
          <div class="use-cases">
            <span class="tag">üîí High Availability</span>
            <span class="tag">üîÑ Auto-Sync</span>
            <span class="tag">üíæ Keeper Coord.</span>
          </div>
        </div>
      </div>

      <!-- Architecture Diagram -->
      <div class="section-title">Live Cluster Architecture</div>
      <div class="cluster-arch glass">
        <div class="ca-box ca-client">
          <div class="ca-icon">üñ•</div>
          <div class="ca-title">Your App</div>
          <div class="ca-sub">INSERT / SELECT</div>
        </div>
        <div class="ca-arrow-col">
          <div class="ca-arrow-line">‚Üì INSERT (fan-out)</div>
          <div class="ca-arrow-line" style="color:var(--green)">‚Üë SELECT (merge)</div>
        </div>
        <div class="ca-box ca-dist">
          <div class="ca-icon">‚ö°</div>
          <div class="ca-title">Distributed Table</div>
          <div class="ca-sub">murmurHash3_32(user_id)</div>
          <div class="ca-sub" style="color:var(--ch-yellow)">ENGINE = Distributed(demo_cluster‚Ä¶)</div>
        </div>
        <div class="ca-arrow-col">
          <div class="ca-arrow-line" style="color:var(--ch-yellow)">‚Üí shard 01</div>
          <div class="ca-arrow-line" style="color:var(--accent2)">‚Üí shard 02</div>
        </div>
        <div class="ca-shards-col">
          <div class="ca-box ca-shard" id="nodeStatusBox1">
            <div class="ca-icon">üü°</div>
            <div class="ca-title">clickhouse-node1</div>
            <div class="ca-sub">Shard 01 ¬∑ Replica 1</div>
            <div class="ca-sub">Port 8124</div>
            <div class="ca-sub" id="ca-node1-status">Checking‚Ä¶</div>
          </div>
          <div class="ca-keeper">
            <div style="font-size:11px;color:var(--text3)">‚Üï ZK sync</div>
            <div class="ca-box ca-keeper-box">
              <div class="ca-icon">üóù</div>
              <div class="ca-title">CH Keeper</div>
              <div class="ca-sub">Port 9181</div>
            </div>
          </div>
          <div class="ca-box ca-shard" id="nodeStatusBox2">
            <div class="ca-icon">üü°</div>
            <div class="ca-title">clickhouse-node2</div>
            <div class="ca-sub">Shard 02 ¬∑ Replica 2</div>
            <div class="ca-sub">Port 8125</div>
            <div class="ca-sub" id="ca-node2-status">Checking‚Ä¶</div>
          </div>
        </div>
      </div>

      <!-- Cluster Topology Table -->
      <div class="section-title" style="margin-top:24px">Live Topology (system.clusters)</div>
      <div class="glass" style="padding:0;overflow:hidden;border-radius:var(--radius);margin-bottom:20px">
        <table class="log-table" id="clusterTopologyTable">
          <thead>
            <tr>
              <th>Cluster</th>
              <th>Shard</th>
              <th>Replica</th>
              <th>Host</th>
              <th>Port</th>
              <th>Is Local</th>
            </tr>
          </thead>
          <tbody id="topoTableBody">
            <tr>
              <td colspan="6" class="loading-row">Loading‚Ä¶</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Two demo sections -->
      <div class="charts-row" style="gap:20px;align-items:flex-start">

        <!-- SHARDING DEMO -->
        <div class="glass" style="flex:1;padding:22px;border-radius:var(--radius)">
          <h3 style="margin-bottom:6px">üîÄ Sharding Demo</h3>
          <p style="font-size:12.5px;color:var(--text2);margin-bottom:16px">8,000 rows were inserted via the
            <code>Distributed</code> table. ClickHouse routed each row to a shard using
            <code>murmurHash3_32(user_id)</code>.
          </p>
          <canvas id="shardDistChart" height="160"></canvas>
          <div class="section-title" style="margin-top:16px">Insert a test row ‚Üí</div>
          <div class="form-row" style="flex-wrap:wrap">
            <div class="form-group">
              <label>User ID</label>
              <input id="shard-user-id" type="text" value="user-42" style="width:140px" />
            </div>
            <div class="form-group">
              <label>Service</label>
              <select id="shard-service">
                <option>frontend</option>
                <option>api-gateway</option>
                <option>auth-service</option>
                <option>payment-service</option>
                <option>ml-inference</option>
              </select>
            </div>
            <button class="btn btn-primary btn-sm" onclick="insertAndRoute()">‚ö° INSERT &amp; Route</button>
          </div>
          <div id="shard-route-result" class="shard-route-result"></div>

          <!-- Cross-shard query button -->
          <div class="section-title" style="margin-top:14px">Cross-shard query ‚Üí</div>
          <button class="btn btn-sm" onclick="runDistributedQuery()">üåê SELECT from Distributed table</button>
          <div class="engine-result" id="distributed-result" style="margin-top:10px"></div>
        </div>

        <!-- REPLICATION DEMO -->
        <div class="glass" style="flex:1;padding:22px;border-radius:var(--radius)">
          <h3 style="margin-bottom:6px">üîÑ Replication Demo</h3>
          <p style="font-size:12.5px;color:var(--text2);margin-bottom:16px">Both nodes share the table
            <code>events_replicated</code> under <em>the same ZK path</em>. Write to node1, and node2 gets it
            automatically via ClickHouse Keeper.
          </p>

          <!-- Row count per replica -->
          <div id="repl-row-counts" class="repl-counts-row">Loading‚Ä¶</div>

          <!-- Live replication button -->
          <div class="section-title" style="margin-top:16px">Prove replication live ‚Üí</div>
          <button class="btn btn-primary" id="replBtn" onclick="runReplicationDemo()">
            ‚úçÔ∏è Write to node1 ‚Üí Verify on node2
          </button>
          <div id="repl-result" class="repl-result"></div>

          <!-- ZK path explanation -->
          <div class="section-title" style="margin-top:16px">How Keeper coordinates this</div>
          <div class="code-block" style="font-size:11px">-- ZooKeeper/Keeper path layout:
            /clickhouse/tables/ha/events_replicated/
            replicas/
            replica-1/ ‚Üê node1 registers here
            log_pointer
            is_active
            host: clickhouse-node1
            replica-2/ ‚Üê node2 registers here
            log_pointer
            is_active
            host: clickhouse-node2
            log/ ‚Üê shared INSERT log
            log-0000001 (INSERT from node1)
            log-0000002 ‚Üí node2 pulls &amp; applies</div>

          <!-- system.replicas -->
          <div class="section-title" style="margin-top:12px">system.replicas ‚Üí</div>
          <button class="btn btn-sm" onclick="loadReplStatus()">üîç Check Replication Status</button>
          <div class="engine-result" id="repl-status-result" style="margin-top:10px"></div>
        </div>
      </div>

      <!-- SQL Reference -->
      <div class="section-title" style="margin-top:24px">Cluster SQL Reference</div>
      <div class="engines-grid" style="grid-template-columns:repeat(2,1fr);gap:14px">
        <div class="engine-card glass" style="padding:18px">
          <div class="engine-badge" style="background:linear-gradient(135deg,#f59e0b,#d97706)">ON CLUSTER</div>
          <div class="code-block" style="font-size:11px;margin-top:8px">-- Run DDL on ALL nodes at once:
            CREATE TABLE telemetry ON CLUSTER demo_cluster
            (
            ts DateTime,
            service String,
            user_id String
            )
            ENGINE = ReplicatedMergeTree(
            '/clickhouse/tables/{shard}/telemetry',
            '{replica}'
            )
            ORDER BY (service, ts);

            -- Then create the Distributed view:
            CREATE TABLE telemetry_all ON CLUSTER demo_cluster
            AS telemetry
            ENGINE = Distributed(
            demo_cluster, currentDatabase(),
            telemetry, rand()
            );</div>
        </div>
        <div class="engine-card glass" style="padding:18px">
          <div class="engine-badge" style="background:linear-gradient(135deg,#6366f1,#4f46e5)">Monitoring</div>
          <div class="code-block" style="font-size:11px;margin-top:8px">-- Check cluster topology:
            SELECT cluster, shard_num, host_name
            FROM system.clusters
            ORDER BY cluster, shard_num;

            -- Monitor replica lag:
            SELECT table, replica_name,
            queue_size,
            inserts_in_queue,
            last_queue_update
            FROM system.replicas;

            -- Replication queue details:
            SELECT database, table, type,
            num_tries, last_exception
            FROM system.replication_queue
            WHERE num_tries > 0
            ORDER BY create_time DESC;</div>
        </div>
      </div>

    </section>

    <!-- ‚îÄ‚îÄ‚îÄ QUERY PLAYGROUND ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <section class="tab-panel" id="tab-query">
      <div class="page-header">
        <h1>SQL Playground</h1>
        <p class="page-subtitle">Run any ClickHouse SQL query against the live demo database. Explore all the tables
          seeded with realistic data.</p>
      </div>

      <div class="playground-layout">
        <div class="playground-sidebar">
          <div class="section-title">Quick Queries</div>
          <div class="quick-queries">
            <button class="quick-query-btn" onclick="setQuery(QUERIES.eventsByHour)">üìä Events by Hour</button>
            <button class="quick-query-btn" onclick="setQuery(QUERIES.topUsers)">üë§ Top Users</button>
            <button class="quick-query-btn" onclick="setQuery(QUERIES.errorRate)">üö® Error Rate</button>
            <button class="quick-query-btn" onclick="setQuery(QUERIES.costByService)">üí∞ Cost by Service</button>
            <button class="quick-query-btn" onclick="setQuery(QUERIES.p95Latency)">‚è± P95 Latency</button>
            <button class="quick-query-btn" onclick="setQuery(QUERIES.uniqueUsers)">üî¢ HLL Unique Users</button>
            <button class="quick-query-btn" onclick="setQuery(QUERIES.systemTables)">üóÑ System Tables</button>
            <button class="quick-query-btn" onclick="setQuery(QUERIES.budgetCollapsing)">üìâ Budget Collapse</button>
            <button class="quick-query-btn" onclick="setQuery(QUERIES.ttlCheck)">‚åõ TTL Info</button>
          </div>

          <div class="section-title" style="margin-top:1.5rem">Tables in demo DB</div>
          <div id="playground-tables" class="table-list">Loading‚Ä¶</div>
        </div>

        <div class="playground-main">
          <div class="editor-wrap glass">
            <div class="editor-toolbar">
              <span class="editor-label">SQL</span>
              <button class="btn btn-primary btn-sm" onclick="runQuery()">‚ñ∂ Run Query</button>
              <button class="btn btn-sm" onclick="clearQuery()">‚úï Clear</button>
            </div>
            <textarea id="queryEditor" spellcheck="false"
              placeholder="SELECT * FROM telemetry_events LIMIT 10;"></textarea>
          </div>
          <div id="queryStatus" class="query-status"></div>
          <div class="results-wrap glass" id="queryResultsWrap" style="display:none">
            <div class="results-header">
              <span id="resultsCount"></span>
              <button class="btn btn-sm" onclick="copyResults()">üìã Copy JSON</button>
            </div>
            <div class="results-table-wrap">
              <table class="results-table" id="resultsTable"></table>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ‚îÄ‚îÄ‚îÄ AI ASSISTANT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <section class="tab-panel" id="tab-ai">
      <div class="page-header">
        <h1>AI Assistant <span id="ai-header-status" style="font-size:14px;font-weight:400;color:var(--text3)">Checking
            Ollama‚Ä¶</span></h1>
        <p class="page-subtitle">Three AI engineering patterns built on top of ClickHouse ‚Äî powered by <strong>Ollama
            (local LLM, no API key)</strong>. Learn how to add AI to any database.</p>
      </div>

      <!-- AI Status Banner -->
      <div id="ai-status-banner" class="ai-status-banner glass" style="display:none"></div>

      <!-- Three-column approach cards -->
      <div class="ai-approach-grid">
        <div class="ai-approach-card glass" onclick="showAISection('chat')">
          <div class="ai-approach-icon" style="background:linear-gradient(135deg,#6366f1,#4f46e5)">üí¨</div>
          <strong>J1 ‚Äî Text-to-SQL</strong>
          <p>Ask questions in plain English ‚Üí LLM generates SQL ‚Üí runs on ClickHouse ‚Üí answer</p>
          <span class="tag">NL ‚Üí SQL</span>
          <span class="tag">Schema Injection</span>
          <span class="tag">Self-Correction</span>
        </div>
        <div class="ai-approach-card glass" onclick="showAISection('insights')">
          <div class="ai-approach-icon" style="background:linear-gradient(135deg,#f59e0b,#d97706)">ü§ñ</div>
          <strong>J2 ‚Äî Insights Agent</strong>
          <p>Agent reads all tables ‚Üí runs diagnostic queries ‚Üí LLM finds patterns ‚Üí surfaces anomalies</p>
          <span class="tag">Agentic Loop</span>
          <span class="tag">Tool Calls</span>
          <span class="tag">Structured JSON</span>
        </div>
        <div class="ai-approach-card glass" onclick="showAISection('rag')">
          <div class="ai-approach-icon" style="background:linear-gradient(135deg,#10b981,#059669)">üìö</div>
          <strong>J3 ‚Äî RAG Search</strong>
          <p>Question ‚Üí embed ‚Üí cosineDistance in ClickHouse ‚Üí top-K chunks ‚Üí LLM answers from context</p>
          <span class="tag">Embeddings</span>
          <span class="tag">cosineDistance()</span>
          <span class="tag">Vector Store</span>
        </div>
      </div>

      <!-- ‚îÄ‚îÄ J1: TEXT-TO-SQL CHAT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <div id="ai-section-chat" class="ai-section">
        <div class="section-title">J1 ‚Äî Text-to-SQL Chatbot</div>
        <div class="ai-pipeline-hint glass">
          <span class="pipe-step">‚ë† Your question</span>
          <span class="pipe-arrow">‚Üí</span>
          <span class="pipe-step">‚ë° Schema injected into prompt</span>
          <span class="pipe-arrow">‚Üí</span>
          <span class="pipe-step">‚ë¢ LLM generates SQL</span>
          <span class="pipe-arrow">‚Üí</span>
          <span class="pipe-step">‚ë£ ClickHouse runs it</span>
          <span class="pipe-arrow">‚Üí</span>
          <span class="pipe-step">‚ë§ LLM summarizes</span>
        </div>

        <div class="chat-container glass">
          <div class="chat-messages" id="chatMessages">
            <div class="chat-msg system">
              üëã Ask me anything about the ClickHouse data. Try: <em>"Which service has the highest error rate?"</em> or
              <em>"What's the total cost this week?"</em> or <em>"How many unique users visited in the last 24
                hours?"</em>
            </div>
          </div>
          <div class="chat-input-row">
            <input id="chatInput" type="text" class="chat-input" placeholder="Ask a question about the data‚Ä¶"
              onkeydown="if(event.key==='Enter') sendChatMessage()" />
            <button class="btn btn-primary" onclick="sendChatMessage()" id="chatSendBtn">Ask ‚Üí</button>
          </div>
        </div>

        <!-- Suggested questions -->
        <div class="chat-suggestions">
          <span class="suggestion-label">Try:</span>
          <button class="suggestion-chip"
            onclick="askSuggested('Which service has the highest error rate in the last 24 hours?')">
            Which service has the highest error rate?
          </button>
          <button class="suggestion-chip" onclick="askSuggested('What is the total API cost this week by team?')">
            Total API cost by team this week
          </button>
          <button class="suggestion-chip"
            onclick="askSuggested('How many unique users were active in the last 24 hours?')">
            Unique users last 24h
          </button>
          <button class="suggestion-chip"
            onclick="askSuggested('Which 5 services had the highest average response time?')">
            Slowest services by P95 latency
          </button>
        </div>
      </div>

      <!-- ‚îÄ‚îÄ J2: AI INSIGHTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <div id="ai-section-insights" class="ai-section" style="display:none">
        <div class="section-title">J2 ‚Äî AI Insights Agent</div>
        <div class="ai-pipeline-hint glass">
          <span class="pipe-step">‚ë† Agent decides which queries to run</span>
          <span class="pipe-arrow">‚Üí</span>
          <span class="pipe-step">‚ë° Gathers data from ClickHouse (tool calls)</span>
          <span class="pipe-arrow">‚Üí</span>
          <span class="pipe-step">‚ë¢ LLM analyzes aggregated data</span>
          <span class="pipe-arrow">‚Üí</span>
          <span class="pipe-step">‚ë£ Structured JSON insights</span>
        </div>

        <div class="insights-controls glass">
          <div class="form-group">
            <label>Analyze section</label>
            <select id="insightsSection">
              <option value="all">All Data (Telemetry + Logs + Costs)</option>
              <option value="telemetry">Telemetry Only</option>
              <option value="logging">Logging Only</option>
              <option value="costs">Costs Only</option>
            </select>
          </div>
          <button class="btn btn-primary" onclick="runInsightsAgent()" id="insightsRunBtn">
            ü§ñ Run Insights Agent
          </button>
        </div>

        <div id="insightsResult" class="insights-result"></div>
      </div>

      <!-- ‚îÄ‚îÄ J3: RAG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <div id="ai-section-rag" class="ai-section" style="display:none">
        <div class="section-title">J3 ‚Äî RAG (Retrieval Augmented Generation)</div>
        <div class="ai-pipeline-hint glass">
          <span class="pipe-step">‚ë† Embed your question (nomic-embed-text)</span>
          <span class="pipe-arrow">‚Üí</span>
          <span class="pipe-step">‚ë° cosineDistance() in ClickHouse</span>
          <span class="pipe-arrow">‚Üí</span>
          <span class="pipe-step">‚ë¢ Top-K relevant chunks</span>
          <span class="pipe-arrow">‚Üí</span>
          <span class="pipe-step">‚ë£ LLM answers from context</span>
        </div>

        <div class="rag-info glass"
          style="font-size:12.5px;color:var(--text2);padding:12px 16px;margin-bottom:16px;border-radius:var(--radius)">
          üì¶ Knowledge base stored in <code>demo.knowledge_embeddings</code> ‚Äî <code>Array(Float32)</code> column,
          searched with <code>cosineDistance(embedding, questionVector)</code>. No Pinecone, no Chroma ‚Äî just
          ClickHouse.
        </div>

        <div class="rag-search-row glass"
          style="display:flex;gap:12px;padding:16px;border-radius:var(--radius);margin-bottom:16px">
          <input id="ragInput" type="text" class="chat-input"
            placeholder="Ask about ClickHouse or AI patterns‚Ä¶ e.g. 'How does MergeTree work?'" style="flex:1"
            onkeydown="if(event.key==='Enter') runRAGQuery()" />
          <button class="btn btn-primary" onclick="runRAGQuery()" id="ragBtn">üîç Search</button>
        </div>

        <div class="chat-suggestions" style="margin-bottom:20px">
          <span class="suggestion-label">Try:</span>
          <button class="suggestion-chip"
            onclick="askRAG('How does MergeTree handle inserts and background merges?')">How does MergeTree
            work?</button>
          <button class="suggestion-chip"
            onclick="askRAG('What is the difference between sharding and replication?')">Sharding vs
            replication</button>
          <button class="suggestion-chip" onclick="askRAG('How do I implement RAG with a database?')">How to implement
            RAG?</button>
          <button class="suggestion-chip" onclick="askRAG('What is an AI agent and how does it call tools?')">What is an
            AI agent?</button>
        </div>

        <div id="ragResult" class="rag-result"></div>

        <!-- Index a custom document -->
        <div class="section-title" style="margin-top:24px">Index Your Own Document</div>
        <div class="glass" style="padding:18px;border-radius:var(--radius)">
          <div class="form-row" style="flex-wrap:wrap;gap:12px;margin-bottom:12px">
            <div class="form-group">
              <label>Source</label>
              <input id="ragIndexSource" type="text" value="my-docs" style="width:120px" />
            </div>
            <div class="form-group">
              <label>Category</label>
              <input id="ragIndexCategory" type="text" value="architecture" style="width:130px" />
            </div>
          </div>
          <textarea id="ragIndexText" rows="4"
            style="width:100%;background:var(--bg3);border:1px solid var(--border);color:var(--text1);border-radius:8px;padding:10px;font-family:inherit;font-size:13px;resize:vertical;box-sizing:border-box"
            placeholder="Paste any text here to add it to the ClickHouse knowledge base‚Ä¶"></textarea>
          <button class="btn btn-sm" style="margin-top:10px" onclick="indexDocument()">üìé Embed & Index into
            ClickHouse</button>
          <div id="ragIndexResult" style="margin-top:10px;font-size:13px"></div>
        </div>
      </div>

    </section>

    <!-- ‚îÄ‚îÄ‚îÄ LEARNING GUIDE (ClickHouse + AI) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <section class="tab-panel" id="tab-guide">
      <div class="guide-layout">
        <aside class="guide-sidebar glass">
          <div class="guide-sidebar-hd">
            <div class="guide-ttl">üìñ Full Stack Guide</div>
            <div class="guide-sub">11 modules ¬∑ ClickHouse + AI</div>
            <div class="guide-prog-wrap">
              <div class="guide-prog-bar" id="guideProgBar" style="width:9.1%"></div>
            </div>
            <div class="guide-prog-lbl" id="guideProgLbl">Module 1 of 11</div>
          </div>
          <div class="guide-mod-list">
            <div
              style="font-size:10px;font-weight:700;letter-spacing:.6px;text-transform:uppercase;color:var(--text3);padding:6px 12px 2px">
              ClickHouse</div>
            <button class="guide-mod-btn active" onclick="showGuideModule(1,this)" id="gbtn-1"><span
                class="guide-mod-n">01</span>
              <div class="guide-mod-meta"><strong>Why ClickHouse?</strong><span>Columnar ¬∑ OLAP ¬∑ Architecture</span>
              </div>
            </button>
            <button class="guide-mod-btn" onclick="showGuideModule(2,this)" id="gbtn-2"><span
                class="guide-mod-n">02</span>
              <div class="guide-mod-meta"><strong>MergeTree: The Core</strong><span>Parts ¬∑ Merges ¬∑ ORDER BY</span>
              </div>
            </button>
            <button class="guide-mod-btn" onclick="showGuideModule(3,this)" id="gbtn-3"><span
                class="guide-mod-n">03</span>
              <div class="guide-mod-meta"><strong>Engine Variants</strong><span>Summing ¬∑ Replacing ¬∑ Collapsing</span>
              </div>
            </button>
            <button class="guide-mod-btn" onclick="showGuideModule(4,this)" id="gbtn-4"><span
                class="guide-mod-n">04</span>
              <div class="guide-mod-meta"><strong>Materialized Views</strong><span>MVs ¬∑ HyperLogLog ¬∑
                  -State/-Merge</span></div>
            </button>
            <button class="guide-mod-btn" onclick="showGuideModule(5,this)" id="gbtn-5"><span
                class="guide-mod-n">05</span>
              <div class="guide-mod-meta"><strong>Logging &amp; TTL</strong><span>Auto-expiry ¬∑ LowCardinality ¬∑
                  Search</span></div>
            </button>
            <button class="guide-mod-btn" onclick="showGuideModule(6,this)" id="gbtn-6"><span
                class="guide-mod-n">06</span>
              <div class="guide-mod-meta"><strong>Cost &amp; Aggregations</strong><span>SummingMT ¬∑ Budget alerts</span>
              </div>
            </button>
            <button class="guide-mod-btn" onclick="showGuideModule(7,this)" id="gbtn-7"><span
                class="guide-mod-n">07</span>
              <div class="guide-mod-meta"><strong>Cluster &amp; Replication</strong><span>Sharding ¬∑ Distributed ¬∑
                  Keeper</span></div>
            </button>
            <div
              style="font-size:10px;font-weight:700;letter-spacing:.6px;text-transform:uppercase;color:var(--accent2);padding:10px 12px 2px">
              ü§ñ AI Layer</div>
            <button class="guide-mod-btn" onclick="showGuideModule(8,this)" id="gbtn-8"><span
                class="guide-mod-n">08</span>
              <div class="guide-mod-meta"><strong>Text-to-SQL (J1)</strong><span>Schema injection ¬∑
                  Self-correction</span></div>
            </button>
            <button class="guide-mod-btn" onclick="showGuideModule(9,this)" id="gbtn-9"><span
                class="guide-mod-n">09</span>
              <div class="guide-mod-meta"><strong>Insights Agent (J2)</strong><span>Agentic loop ¬∑ Structured
                  JSON</span></div>
            </button>
            <button class="guide-mod-btn" onclick="showGuideModule(10,this)" id="gbtn-10"><span
                class="guide-mod-n">10</span>
              <div class="guide-mod-meta"><strong>RAG Search (J3)</strong><span>Embeddings ¬∑ cosineDistance</span></div>
            </button>
            <button class="guide-mod-btn" onclick="showGuideModule(11,this)" id="gbtn-11"><span
                class="guide-mod-n">11</span>
              <div class="guide-mod-meta"><strong>MCP Server (J4)</strong><span>Tools ¬∑ Claude Desktop</span></div>
            </button>
          </div>
        </aside>

        <div class="guide-main">

          <!-- MOD 1 -->
          <div class="guide-lesson" id="glesson-1">
            <div class="guide-lesson-hd">
              <div class="guide-lesson-num">Module 01 ¬∑ ClickHouse</div>
              <h2 class="guide-lesson-title">Why ClickHouse?</h2>
              <p class="guide-lesson-desc">Understand what makes ClickHouse fundamentally different from traditional
                databases ‚Äî and when to reach for it.</p>
              <div class="guide-tags"><span class="tag">Columnar Storage</span><span class="tag">OLAP vs
                  OLTP</span><span class="tag">Vectorized Execution</span></div>
            </div>
            <div class="guide-callout guide-callout--key">
              <div class="guide-callout-label">üí° Core Idea</div>Traditional databases store rows together on disk.
              ClickHouse stores <strong>columns</strong> together. <code>SELECT AVG(revenue)</code> on a 100-column
              table reads only the <code>revenue</code> column ‚Äî not the other 99. This gives 10‚Äì100x analytics
              speedups.
            </div>
            <h3 class="guide-h3">Row vs Columnar Storage</h3>
            <div class="guide-compare">
              <div class="guide-compare-side">
                <div class="guide-compare-label guide-compare-label--bad">Row Store (Postgres, MySQL)</div>
                <div class="guide-code-sm">Disk: [id|name|revenue|ts][id|name|...]...

                  SELECT AVG(revenue) FROM events;
                  ‚Üí Must read ALL columns every row
                  ‚Üí I/O: 100% of table ‚Üí Slow</div>
              </div>
              <div class="guide-compare-side">
                <div class="guide-compare-label guide-compare-label--good">Columnar (ClickHouse)</div>
                <div class="guide-code-sm">Disk: [id][id]... [name][name]... [revenue]...

                  SELECT AVG(revenue) FROM events;
                  ‚Üí Reads ONLY the revenue column
                  ‚Üí I/O: 1% of table ‚Üí 100x faster</div>
              </div>
            </div>
            <div class="guide-callout guide-callout--info">
              <div class="guide-callout-label">üìä When to Use ClickHouse</div>
              <div class="guide-two-col">
                <div>
                  <div class="guide-check-item">‚úÖ Analytics (aggregations, GROUP BY)</div>
                  <div class="guide-check-item">‚úÖ Time-series (logs, metrics, events)</div>
                  <div class="guide-check-item">‚úÖ Billions of rows, read-heavy</div>
                </div>
                <div>
                  <div class="guide-check-item guide-x">‚ùå Row-level updates (use Postgres)</div>
                  <div class="guide-check-item guide-x">‚ùå Complex transactions</div>
                  <div class="guide-check-item guide-x">‚ùå Small data under 1M rows</div>
                </div>
              </div>
            </div>
            <div class="guide-code-block">-- Check actual compression ratio on your data:
              SELECT
              formatReadableSize(sum(bytes)) AS disk_size,
              formatReadableSize(sum(data_uncompressed_bytes)) AS raw_size,
              round(sum(data_uncompressed_bytes)/sum(bytes),1) AS compression_ratio
              FROM system.parts WHERE database = 'demo' AND active;</div>
            <div class="guide-next-row"><button class="btn btn-primary" onclick="goToTab('home')">‚Üí Explore Introduction
                tab</button><button class="btn" onclick="showGuideModule(2,document.getElementById('gbtn-2'))">Next:
                MergeTree ‚Üí</button></div>
          </div>

          <!-- MOD 2 -->
          <div class="guide-lesson" id="glesson-2" style="display:none">
            <div class="guide-lesson-hd">
              <div class="guide-lesson-num">Module 02 ¬∑ ClickHouse</div>
              <h2 class="guide-lesson-title">MergeTree: The Foundation</h2>
              <p class="guide-lesson-desc">Every ClickHouse engine is built on MergeTree. Understanding how it stores
                and merges data is the single most important concept.</p>
              <div class="guide-tags"><span class="tag">Parts</span><span class="tag">Merges</span><span
                  class="tag">ORDER BY</span><span class="tag">Sparse Index</span></div>
            </div>
            <div class="guide-callout guide-callout--key">
              <div class="guide-callout-label">üí° Core Idea</div>ClickHouse never updates rows in-place. Every INSERT
              creates a new <strong>"part"</strong> (folder of column files). Background <strong>merge jobs</strong>
              combine small parts into larger sorted ones. Writes are always sequential appends ‚Äî fast for both INSERT
              and SELECT.
            </div>
            <h3 class="guide-h3">The Parts Lifecycle</h3>
            <div class="guide-code-block">/data/demo/telemetry_events/
              20240101_1_1_0/ ‚Üê part from INSERT #1 (sorted by ORDER BY)
              20240101_2_2_0/ ‚Üê part from INSERT #2
              20240101_1_3_1/ ‚Üê merged (fully sorted, old parts deleted)

              -- Each part has one file per column:
              timestamp.bin service.bin primary.idx (1 entry per 8192 rows)</div>
            <div class="guide-callout guide-callout--warn">
              <div class="guide-callout-label">‚ö†Ô∏è Most Important Schema Decision</div><code>ORDER BY</code> is NOT a
              primary key ‚Äî it is the <strong>physical sort order on disk</strong>. Queries filtering on ORDER BY
              columns skip most data using the sparse index. Queries on other columns scan everything.
            </div>
            <h3 class="guide-h3">Choosing ORDER BY</h3>
            <div class="guide-compare">
              <div class="guide-compare-side">
                <div class="guide-compare-label guide-compare-label--bad">Wrong ORDER BY</div>
                <div class="guide-code-sm">ORDER BY (id) -- random IDs
                  WHERE service='api-gateway'
                  ‚Üí Full table scan every time</div>
              </div>
              <div class="guide-compare-side">
                <div class="guide-compare-label guide-compare-label--good">Right ORDER BY</div>
                <div class="guide-code-sm">ORDER BY (service, timestamp)
                  WHERE service='api-gateway'
                  ‚Üí Sparse index skip ‚Üí fast!</div>
              </div>
            </div>
            <div class="guide-code-block">CREATE TABLE app_logs (
              timestamp DateTime,
              service LowCardinality(String),
              level LowCardinality(String),
              message String
              ) ENGINE = MergeTree()
              ORDER BY (service, level, timestamp) -- ‚Üê most-filtered columns first
              PARTITION BY toYYYYMM(timestamp) -- ‚Üê monthly lifecycle
              TTL timestamp + INTERVAL 90 DAY; -- ‚Üê auto-delete after 90 days</div>
            <div class="guide-next-row"><button class="btn btn-primary" onclick="goToTab('engines')">‚Üí Try the Engines
                tab</button><button class="btn" onclick="showGuideModule(3,document.getElementById('gbtn-3'))">Next:
                Engine Variants ‚Üí</button></div>
          </div>

          <!-- MOD 3 -->
          <div class="guide-lesson" id="glesson-3" style="display:none">
            <div class="guide-lesson-hd">
              <div class="guide-lesson-num">Module 03 ¬∑ ClickHouse</div>
              <h2 class="guide-lesson-title">Engine Variants</h2>
              <p class="guide-lesson-desc">All ClickHouse engines inherit from MergeTree and differ only in what happens
                <em>during background merges</em>.</p>
              <div class="guide-tags"><span class="tag">SummingMergeTree</span><span
                  class="tag">ReplacingMergeTree</span><span class="tag">CollapsingMergeTree</span></div>
            </div>
            <div class="guide-callout guide-callout--key">
              <div class="guide-callout-label">üí° The Pattern</div>Every variant adds one behavior: <em>"when merging
                rows with the same ORDER BY key, do X."</em> Everything else is identical to MergeTree.
            </div>
            <h3 class="guide-h3">SummingMergeTree ‚Äî Auto-sum counters</h3>
            <div class="guide-code-block">ENGINE = SummingMergeTree((cost_usd, api_calls))
              ORDER BY (team, service, toDate(timestamp))
              -- Inserts: (platform, api, 0.05, 100) + (platform, api, 0.08, 80)
              -- After merge: (platform, api, 0.13, 180) ‚Üê auto-summed!
              -- Always query with sum() for correctness:
              SELECT service, sum(cost_usd) AS total FROM cost_usage GROUP BY service;</div>
            <h3 class="guide-h3">ReplacingMergeTree ‚Äî Upserts</h3>
            <div class="guide-code-block">ENGINE = ReplacingMergeTree(version) -- higher version wins
              ORDER BY (date, service, error_msg)
              -- Re-insert with higher version = upsert
              INSERT INTO error_summary VALUES (today(), 'api', 'timeout', 42, now64());
              SELECT * FROM error_summary FINAL; -- FINAL forces dedup now</div>
            <h3 class="guide-h3">CollapsingMergeTree ‚Äî Corrections with sign</h3>
            <div class="guide-code-block">ENGINE = CollapsingMergeTree(sign) -- +1=insert, -1=cancel
              -- Correct a budget: cancel old row, insert new one
              INSERT INTO budget_limits VALUES ('2024-01-01', 'platform', 5000.0, -1), -- cancel
              ('2024-01-01', 'platform', 7500.0, +1); -- new
              SELECT team, sum(budget_usd * sign) AS net FROM budget_limits GROUP BY team;</div>
            <div class="guide-next-row"><button class="btn btn-primary" onclick="goToTab('engines')">‚Üí Run all engine
                demos</button><button class="btn" onclick="showGuideModule(4,document.getElementById('gbtn-4'))">Next:
                Materialized Views ‚Üí</button></div>
          </div>

          <!-- MOD 4 -->
          <div class="guide-lesson" id="glesson-4" style="display:none">
            <div class="guide-lesson-hd">
              <div class="guide-lesson-num">Module 04 ¬∑ ClickHouse</div>
              <h2 class="guide-lesson-title">Materialized Views &amp; Approximations</h2>
              <p class="guide-lesson-desc">Pre-compute results at insert time so dashboards query in milliseconds.</p>
              <div class="guide-tags"><span class="tag">Materialized Views</span><span
                  class="tag">HyperLogLog</span><span class="tag">-State/-Merge</span></div>
            </div>
            <div class="guide-callout guide-callout--key">
              <div class="guide-callout-label">üí° Core Idea</div>A <strong>Materialized View</strong> is like a trigger
              ‚Äî every INSERT into the source table auto-runs a SELECT and inserts the result into a target table. Target
              is usually AggregatingMergeTree storing <em>partial states</em>.
            </div>
            <div class="guide-code-block">-- Target: partial aggregate states
              CREATE TABLE telemetry_hourly_agg (
              hour DateTime, service LowCardinality(String),
              event_count AggregateFunction(count),
              unique_users AggregateFunction(uniq, String)
              ) ENGINE = AggregatingMergeTree() ORDER BY (service, hour);

              -- MV fires on every INSERT into telemetry_events:
              CREATE MATERIALIZED VIEW mv_hourly TO telemetry_hourly_agg AS
              SELECT toStartOfHour(timestamp) AS hour, service,
              countState() AS event_count, uniqState(user_id) AS unique_users
              FROM telemetry_events GROUP BY hour, service;

              -- Query with -Merge to combine states:
              SELECT hour, countMerge(event_count), uniqMerge(unique_users)
              FROM telemetry_hourly_agg GROUP BY hour ORDER BY hour DESC;</div>
            <div class="guide-callout guide-callout--info">
              <div class="guide-callout-label">üìê HyperLogLog: COUNT DISTINCT at Scale</div><code>uniq(user_id)</code>
              uses HyperLogLog ‚Äî estimates distinct values in <strong>constant 2KB memory</strong>, regardless of
              cardinality. &lt;1% error. Use <code>uniqExact()</code> only when exactness is required
              (billing/compliance).
            </div>
            <div class="guide-next-row"><button class="btn btn-primary" onclick="goToTab('telemetry')">‚Üí See Telemetry
                data</button><button class="btn" onclick="showGuideModule(5,document.getElementById('gbtn-5'))">Next:
                Logging &amp; TTL ‚Üí</button></div>
          </div>

          <!-- MOD 5 -->
          <div class="guide-lesson" id="glesson-5" style="display:none">
            <div class="guide-lesson-hd">
              <div class="guide-lesson-num">Module 05 ¬∑ ClickHouse</div>
              <h2 class="guide-lesson-title">Structured Logging &amp; TTL</h2>
              <p class="guide-lesson-desc">ClickHouse as a log store: auto-expiring data, instant aggregations,
                sub-second text search.</p>
              <div class="guide-tags"><span class="tag">TTL</span><span class="tag">LowCardinality</span><span
                  class="tag">LIKE Search</span></div>
            </div>
            <div class="guide-callout guide-callout--key">
              <div class="guide-callout-label">üí° Core Idea</div><strong>TTL</strong> automatically deletes or moves old
              rows based on a time expression. Runs as a background operation during merges ‚Äî no cron jobs, no manual
              cleanup.
            </div>
            <div class="guide-code-block">CREATE TABLE app_logs (
              timestamp DateTime,
              level LowCardinality(String), -- ‚Üê 10x compression vs plain String
              service LowCardinality(String),
              message String
              ) ENGINE = MergeTree()
              ORDER BY (service, level, timestamp)
              TTL timestamp + INTERVAL 90 DAY DELETE; -- auto-delete after 90d

              -- Error rate per service (sub-second on millions of rows):
              SELECT service,
              round(countIf(level='ERROR')/count()*100,2) AS error_pct
              FROM app_logs WHERE timestamp >= now() - INTERVAL 24 HOUR
              GROUP BY service ORDER BY error_pct DESC;</div>
            <div class="guide-next-row"><button class="btn btn-primary" onclick="goToTab('logging')">‚Üí Explore live
                logs</button><button class="btn" onclick="showGuideModule(6,document.getElementById('gbtn-6'))">Next:
                Cost Tracking ‚Üí</button></div>
          </div>

          <!-- MOD 6 -->
          <div class="guide-lesson" id="glesson-6" style="display:none">
            <div class="guide-lesson-hd">
              <div class="guide-lesson-num">Module 06 ¬∑ ClickHouse</div>
              <h2 class="guide-lesson-title">Cost Tracking &amp; Aggregations</h2>
              <p class="guide-lesson-desc">SummingMergeTree self-maintains totals; CollapsingMergeTree handles
                corrections without mutations.</p>
              <div class="guide-tags"><span class="tag">SummingMergeTree</span><span
                  class="tag">CollapsingMergeTree</span><span class="tag">Budget Alerts</span></div>
            </div>
            <div class="guide-callout guide-callout--key">
              <div class="guide-callout-label">üí° Core Idea</div><strong>SummingMergeTree</strong> is zero-cost
              aggregation. Every merge auto-sums your numeric columns. No ETL job, no cron, no scheduled aggregation ‚Äî
              the DB maintains totals itself.
            </div>
            <div class="guide-code-block">-- Budget alert: which teams exceeded 80% of budget?
              SELECT cu.team, sum(cu.cost_usd) AS spend,
              sum(bl.budget_usd * bl.sign) AS budget,
              round(100.0 * sum(cu.cost_usd) / sum(bl.budget_usd * bl.sign), 1) AS used_pct
              FROM cost_usage cu
              JOIN budget_limits bl ON cu.team = bl.team
              WHERE cu.timestamp >= today()
              GROUP BY cu.team HAVING spend > budget * 0.8
              ORDER BY used_pct DESC;</div>
            <div class="guide-next-row"><button class="btn btn-primary" onclick="goToTab('costs')">‚Üí See live cost
                data</button><button class="btn" onclick="showGuideModule(7,document.getElementById('gbtn-7'))">Next:
                Cluster ‚Üí</button></div>
          </div>

          <!-- MOD 7 -->
          <div class="guide-lesson" id="glesson-7" style="display:none">
            <div class="guide-lesson-hd">
              <div class="guide-lesson-num">Module 07 ¬∑ ClickHouse</div>
              <h2 class="guide-lesson-title">Cluster &amp; Replication</h2>
              <p class="guide-lesson-desc">Scale out with sharding, stay up with replication ‚Äî understand the
                difference.</p>
              <div class="guide-tags"><span class="tag">Distributed Table</span><span class="tag">Sharding</span><span
                  class="tag">ReplicatedMergeTree</span><span class="tag">ClickHouse Keeper</span></div>
            </div>
            <div class="guide-callout guide-callout--key">
              <div class="guide-callout-label">üí° Two Different Concepts</div><strong>Sharding</strong> = split
              <em>different</em> data across nodes (scale). <strong>Replication</strong> = copy the <em>same</em> data
              (availability). Production = 2 shards √ó 2 replicas = 4 nodes.
            </div>
            <div class="guide-code-block">-- Distributed table: virtual, fans out to shards
              ENGINE = Distributed(
              demo_cluster, -- cluster name
              default, -- database
              events_local, -- local table on each shard
              murmurHash3_32(user_id) -- sharding key (deterministic routing)
              );
              -- INSERT ‚Üí Distributed ‚Üí routes to correct shard
              -- SELECT ‚Üí Distributed ‚Üí parallel scans all shards, merges results

              -- Replication: same ZK path, different {replica} macro
              ENGINE = ReplicatedMergeTree(
              '/clickhouse/tables/ha/events', -- shared ZK path
              '{replica}' -- expands per-node: replica-1, replica-2
              );
              -- Write to node1 ‚Üí Keeper logs it ‚Üí node2 fetches and applies automatically</div>
            <div class="guide-callout guide-callout--info">
              <div class="guide-callout-label">üèÅ ClickHouse Fundamentals Complete!</div>You now understand columnar
              storage ‚Üí MergeTree ‚Üí engine variants ‚Üí MVs ‚Üí TTL ‚Üí sharding + replication. Now let‚Äôs add the AI layer on
              top.
            </div>
            <div class="guide-next-row"><button class="btn btn-primary" onclick="goToTab('cluster')">‚Üí See live cluster
                demo</button><button class="btn" onclick="showGuideModule(8,document.getElementById('gbtn-8'))">Next:
                Text-to-SQL ‚Üí</button></div>
          </div>

          <!-- MOD 8: Text-to-SQL -->
          <div class="guide-lesson" id="glesson-8" style="display:none">
            <div class="guide-lesson-hd">
              <div class="guide-lesson-num">Module 08 ¬∑ AI Layer (J1)</div>
              <h2 class="guide-lesson-title">Text-to-SQL</h2>
              <p class="guide-lesson-desc">Let users ask questions in plain English and get answers from your ClickHouse
                database ‚Äî no SQL required. See how schema injection and self-correction make this reliable.</p>
              <div class="guide-tags"><span class="tag">Schema Injection</span><span
                  class="tag">Self-Correction</span><span class="tag">Few-Shot Prompting</span></div>
            </div>
            <div class="guide-callout guide-callout--key">
              <div class="guide-callout-label">üí° Core Idea</div>LLMs don‚Äôt know your tables. You inject the schema into
              the prompt. The LLM generates SQL. If it fails, you feed the error back so it can self-correct. This is
              the same pattern used by GitHub Copilot and Claude.
            </div>
            <h3 class="guide-h3">The Pipeline (5 steps)</h3>
            <div class="guide-code-block">1. USER: "Which service has the most errors today?"

              2. SCHEMA INJECTION: inject table/column definitions into prompt
              so the LLM knows your exact schema (no hallucinated columns)

              3. SQL GENERATION: LLM outputs:
              SELECT service, countIf(level='ERROR') AS errors
              FROM demo.app_logs
              WHERE timestamp >= today()
              GROUP BY service ORDER BY errors DESC LIMIT 5

              4. EXECUTE on ClickHouse ‚Üí if it fails, feed error back:
              "That failed: Unknown column 'error_count'. Fix using only the schema."
              LLM corrects the SQL (retry up to 3x)

              5. SUMMARIZE: LLM turns rows into: "The api-gateway service had
              the most errors today (1,247), followed by auth-service (892)"</div>
            <div class="guide-callout guide-callout--warn">
              <div class="guide-callout-label">‚ö†Ô∏è Why Schema Accuracy Matters</div>If your schema says
              <code>error_count</code> but the real column is <code>error_msg</code>, the LLM will use the wrong name
              and the query will fail. Always copy column names directly from <code>system.columns</code>.
            </div>
            <div class="guide-code-block">-- Get exact schema to paste into your LLM prompt:
              SELECT name, type, comment
              FROM system.columns
              WHERE database = 'demo' AND table = 'app_logs'
              ORDER BY position;</div>
            <div class="guide-next-row"><button class="btn btn-primary" onclick="goToTab('ai')">‚Üí Try the Text-to-SQL
                chatbot</button><button class="btn" onclick="showGuideModule(9,document.getElementById('gbtn-9'))">Next:
                Insights Agent ‚Üí</button></div>
          </div>

          <!-- MOD 9: Insights Agent -->
          <div class="guide-lesson" id="glesson-9" style="display:none">
            <div class="guide-lesson-hd">
              <div class="guide-lesson-num">Module 09 ¬∑ AI Layer (J2)</div>
              <h2 class="guide-lesson-title">Insights Agent</h2>
              <p class="guide-lesson-desc">Instead of waiting for users to ask questions, the agent proactively scans
                your data, finds anomalies, and surfaces actionable insights.</p>
              <div class="guide-tags"><span class="tag">Agentic Loop</span><span class="tag">Tool Calls</span><span
                  class="tag">Structured JSON</span></div>
            </div>
            <div class="guide-callout guide-callout--key">
              <div class="guide-callout-label">üí° What‚Äôs an Agent?</div>An agent is a loop: <strong>Observe</strong>
              (run SQL queries to gather data) ‚Üí <strong>Think</strong> (what does this mean?) ‚Üí <strong>Act</strong>
              (return insights or call more tools). Our agent runs 3 diagnostic queries then asks the LLM to find
              patterns.
            </div>
            <div class="guide-code-block">// Step 1: Agent gathers real data (tool calls)
              const telemetry = await query(`
              SELECT service, quantile(0.95)(duration_ms) AS p95_ms,
              countIf(event_type='error')/count() AS error_rate
              FROM demo.telemetry_events
              WHERE timestamp >= now() - INTERVAL 24 HOUR
              GROUP BY service
              `);
              const logs = await query(`SELECT service, round(countIf(level='ERROR')/count()*100,2) AS error_pct ...`);
              const costs = await query(`SELECT service, sum(cost_usd) AS daily_spend ...`);

              // Step 2: Send ALL data to LLM, ask for structured JSON
              const insights = await askLLM(`
              Analyze this data: ${JSON.stringify({ telemetry, logs, costs })}
              Return a JSON array: [{severity, title, detail, recommendation}]
              Find the 3-5 most important issues.
              `);

              // Step 3: Parse and render cards
              // [{severity:"critical", title:"High P95 on data-pipeline",
              // detail:"2882ms is 2x the average", recommendation:"Check slow queries"}]</div>
            <div class="guide-callout guide-callout--info">
              <div class="guide-callout-label">üìå Key: Structured Output</div>By telling the LLM to return JSON with a
              specific schema, you get machine-readable results you can render as cards, alerts, or dashboards. Extract
              with: <code>JSON.parse(response.match(/\[\s\S\*\]/)[0])</code>
            </div>
            <div class="guide-next-row"><button class="btn btn-primary" onclick="goToTab('ai')">‚Üí Run the Insights
                Agent</button><button class="btn" onclick="showGuideModule(10,document.getElementById('gbtn-10'))">Next:
                RAG Search ‚Üí</button></div>
          </div>

          <!-- MOD 10: RAG -->
          <div class="guide-lesson" id="glesson-10" style="display:none">
            <div class="guide-lesson-hd">
              <div class="guide-lesson-num">Module 10 ¬∑ AI Layer (J3)</div>
              <h2 class="guide-lesson-title">RAG with ClickHouse as Vector Store</h2>
              <p class="guide-lesson-desc">Teach the LLM about your internal docs, runbooks, and architecture ‚Äî using
                ClickHouse as the vector database. No Pinecone needed.</p>
              <div class="guide-tags"><span class="tag">Embeddings</span><span class="tag">cosineDistance()</span><span
                  class="tag">Array(Float32)</span></div>
            </div>
            <div class="guide-callout guide-callout--key">
              <div class="guide-callout-label">üí° Core Idea</div>Embedding models convert text into a list of 768
              numbers (a vector). Similar texts have similar vectors. Store these in ClickHouse as
              <code>Array(Float32)</code> and find similar documents using <code>cosineDistance()</code>.
            </div>
            <h3 class="guide-h3">INDEX Phase (run once per document)</h3>
            <div class="guide-code-block">// 1. Chunk the text (400 chars, 50 char overlap)
              // 2. Embed each chunk via Ollama nomic-embed-text model
              const embedding = await fetch('http://localhost:11434/api/embeddings', {
              method: 'POST',
              body: JSON.stringify({ model: 'nomic-embed-text', prompt: chunk })
              }).then(r => r.json()).then(d => d.embedding); // ‚Üí number[768]

              // 3. Store in ClickHouse
              CREATE TABLE demo.knowledge_embeddings (
              source LowCardinality(String),
              category LowCardinality(String),
              content String,
              embedding Array(Float32) -- ‚Üê 768 floats stored here
              ) ENGINE = MergeTree() ORDER BY (source, category);

              INSERT INTO knowledge_embeddings VALUES ('my-runbook', 'incidents', text, [0.23, -0.18, ...]);</div>
            <h3 class="guide-h3">QUERY Phase (every user question)</h3>
            <div class="guide-code-block">// 1. Embed the user question
              const qVector = await embed("What causes payment service errors?");

              // 2. Find the 5 most similar chunks in ClickHouse
              SELECT source, content,
              cosineDistance(embedding, [${qVector.join(',')}]) AS distance
              FROM demo.knowledge_embeddings
              ORDER BY distance ASC -- 0 = identical, 2 = opposite
              LIMIT 5;

              // 3. Include retrieved chunks in the LLM prompt
              // "Answer using ONLY this context: [chunks...]. Question: ..."
              // ‚Üí LLM answers from your docs, cites sources, doesn't hallucinate</div>
            <div class="guide-callout guide-callout--info">
              <div class="guide-callout-label">üì¶ Why ClickHouse Instead of Pinecone?</div>Pinecone is a separate paid
              service. ClickHouse can store your vectors in the same DB as your telemetry/logs, enabling
              <code>JOIN</code>s between your knowledge base and live operational data. Cost: free (you‚Äôre already
              running ClickHouse).
            </div>
            <div class="guide-next-row"><button class="btn btn-primary" onclick="goToTab('ai')">‚Üí Try the RAG
                search</button><button class="btn"
                onclick="showGuideModule(11,document.getElementById('gbtn-11'))">Next: MCP Server ‚Üí</button></div>
          </div>

          <!-- MOD 11: MCP -->
          <div class="guide-lesson" id="glesson-11" style="display:none">
            <div class="guide-lesson-hd">
              <div class="guide-lesson-num">Module 11 ¬∑ AI Layer (J4)</div>
              <h2 class="guide-lesson-title">MCP Server</h2>
              <p class="guide-lesson-desc">Let Claude Desktop or Cursor query your live ClickHouse data directly ‚Äî by
                building an MCP server that exposes your database as AI tools.</p>
              <div class="guide-tags"><span class="tag">MCP Protocol</span><span class="tag">Tool Definition</span><span
                  class="tag">Claude Desktop</span><span class="tag">STDIO Transport</span></div>
            </div>
            <div class="guide-callout guide-callout--key">
              <div class="guide-callout-label">üí° Core Idea</div>MCP (Model Context Protocol) lets AI clients call
              functions you define. You describe a tool ‚Äî its name, what it does, and what inputs it takes. The AI reads
              this description and decides when to call it.
            </div>
            <div class="guide-code-block">// A tool definition has 3 things:
              {
              name: 'get_top_errors',

              // The AI reads this to decide WHEN to call the tool:
              description: 'Get most frequent error messages in the last N hours.',

              inputSchema: {
              type: 'object',
              properties: {
              hours: { type: 'number', description: 'Hours to look back (default: 24)' },
              limit: { type: 'number', description: 'Max results (default: 10)' }
              }
              }
              }

              // The handler runs the SQL and returns results:
              case 'get_top_errors': {
              const rows = await query(`
              SELECT service, message, count() AS hits
              FROM demo.app_logs
              WHERE level = 'ERROR' AND timestamp >= now() - INTERVAL ${args.hours ?? 24} HOUR
              GROUP BY service, message ORDER BY hits DESC LIMIT ${args.limit ?? 10}
              `);
              return { content: [{ type: 'text', text: JSON.stringify(rows, null, 2) }] };
              }</div>
            <h3 class="guide-h3">Connect to Claude Desktop</h3>
            <div class="guide-code-block">// ~/Library/Application Support/Claude/claude_desktop_config.json
              {
              "mcpServers": {
              "clickhouse": {
              "command": "node",
              "args": ["/path/to/backend/mcp-server.js"],
              "env": { "CLICKHOUSE_HOST": "localhost", "CLICKHOUSE_PORT": "8123" }
              }
              }
              }
              // Restart Claude ‚Üí ask: "Show me the top errors from the last hour"
              // Claude calls get_top_errors({hours:1}) ‚Üí real ClickHouse data in response!

              // ‚ö†Ô∏è GOTCHA: Never use console.log in MCP servers!
              // stdout is reserved for JSON-RPC. Use process.stderr.write() instead.</div>
            <div class="guide-callout guide-callout--info">
              <div class="guide-callout-label">üèÜ You‚Äôve completed the Full Stack Guide!</div>You now know: ClickHouse
              columnar architecture ‚Üí MergeTree engines ‚Üí MVs &amp; TTL ‚Üí clustering ‚Üí Text-to-SQL ‚Üí AI agents ‚Üí RAG ‚Üí
              MCP. You have the full picture of building production AI systems on top of ClickHouse.
            </div>
            <div class="guide-next-row"><button class="btn btn-primary" onclick="goToTab('ai')">‚Üí Explore the AI
                Assistant</button><button class="btn btn-primary" onclick="goToTab('query')">‚Üí Try SQL
                Playground</button></div>
          </div>

        </div><!-- guide-main -->
      </div><!-- guide-layout -->
    </section>

  </main>

  <script src="app.js"></script>
</body>

</html>